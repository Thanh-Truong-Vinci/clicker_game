<main class="game">
  <header class="hud">
    <div class="brand">
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="g" x1="0" x2="1">
              <stop offset="0%" stop-color="#7C4DFF" />
              <stop offset="100%" stop-color="#00E5FF" />
            </linearGradient>
          </defs>
          <path
            fill="url(#g)"
            d="M32 3l7.8 15.8L57 21l-12.5 12 3 17-15.5-8.2L16.5 50l3-17L7 21l17.2-2.2L32 3z"
          />
        </svg>
      </div>
      <h1>{{ title() }}</h1>
    </div>

    <div class="stats">
      <div class="stat">
        <span class="label">Éclats</span>
        <span class="value">{{ fmt(money()) }}</span>
      </div>

      <div class="stat" title="Par clic">
        <span class="label">/clic</span>
        <span class="value">{{ fmt(perClick()) }}</span>
      </div>

      <div class="stat" title="Par seconde">
        <span class="label">/sec</span>
        <span class="value">{{ fmt(cps()) }}</span>
      </div>

      @if (autoClickerUnlocked()) {
        <div class="stat" title="Auto-cliqueur actif">
          <span class="label">Auto</span>
          <span class="value">ON</span>
        </div>
      }

      <button class="ghost" (click)="reset()" aria-label="Réinitialiser">
        ↺
      </button>
    </div>
  </header>

  <!-- ZONE DE JEU / JOYAU -->
  <section class="play">
    <!-- couche d’effets pour les éclats -->
    <div class="fx-layer" #fxLayer></div>

    <!-- bouton principal -->
    <button
      class="big-button"
      #clickButton
      (click)="click()"
      aria-label="Cliquer pour gagner des éclats"
    >
      <!-- Joyau rond facetté (sans taches blanches) -->
      <svg
        viewBox="0 0 120 120"
        xmlns="http://www.w3.org/2000/svg"
        class="mascot"
      >
        <defs>
          <!-- Halo externe -->
          <radialGradient id="gemHaloRound" cx="50%" cy="50%" r="55%">
            <stop offset="0%" stop-color="#93c5fd" stop-opacity="0.9" />
            <stop offset="60%" stop-color="#1d4ed8" stop-opacity="0.4" />
            <stop offset="100%" stop-color="transparent" />
          </radialGradient>

          <!-- Dégradé principal (gemme ronde) -->
          <radialGradient id="gemRoundBody" cx="50%" cy="35%" r="60%">
            <stop offset="0%" stop-color="#f9fafb" stop-opacity="0.95" />
            <stop offset="25%" stop-color="#bfdbfe" stop-opacity="0.95" />
            <stop offset="60%" stop-color="#3b82f6" stop-opacity="0.98" />
            <stop offset="100%" stop-color="#1e3a8a" stop-opacity="1" />
          </radialGradient>

          <!-- Facettes froides -->
          <linearGradient id="facetRoundCool" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#e0f2fe" stop-opacity="0.9" />
            <stop offset="100%" stop-color="#93c5fd" stop-opacity="0.1" />
          </linearGradient>

          <!-- Facettes chaudes internes -->
          <linearGradient id="facetRoundWarm" x1="0" y1="1" x2="1" y2="0">
            <stop offset="0%" stop-color="#fef3c7" stop-opacity="0.8" />
            <stop offset="100%" stop-color="#facc15" stop-opacity="0.05" />
          </linearGradient>
        </defs>

        <!-- Halo autour du joyau -->
        <circle cx="60" cy="60" r="52" fill="url(#gemHaloRound)" />

        <!-- Corps principal : disque -->
        <circle
          cx="60"
          cy="60"
          r="42"
          fill="url(#gemRoundBody)"
          stroke="#e5e7eb"
          stroke-width="1.5"
        />

        <!-- Facettes radiales (triangles) -->
        <!-- Top -->
        <polygon
          points="60,60 60,18 90,26"
          fill="url(#facetRoundCool)"
          opacity="0.5"
        />
        <polygon
          points="60,60 30,26 60,18"
          fill="url(#facetRoundCool)"
          opacity="0.45"
        />

        <!-- Haut-droite / haut-gauche -->
        <polygon
          points="60,60 90,26 102,52"
          fill="#1d4ed8"
          opacity="0.35"
        />
        <polygon
          points="60,60 18,52 30,26"
          fill="#2563eb"
          opacity="0.35"
        />

        <!-- Droite / gauche -->
        <polygon
          points="60,60 102,52 102,68"
          fill="#1e40af"
          opacity="0.4"
        />
        <polygon
          points="60,60 18,68 18,52"
          fill="#1e40af"
          opacity="0.4"
        />

        <!-- Bas-droite / bas-gauche -->
        <polygon
          points="60,60 102,68 88,96"
          fill="#111827"
          opacity="0.6"
        />
        <polygon
          points="60,60 32,96 18,68"
          fill="#111827"
          opacity="0.6"
        />

        <!-- Bas -->
        <polygon
          points="60,60 88,96 60,104"
          fill="#020617"
          opacity="0.75"
        />
        <polygon
          points="60,60 60,104 32,96"
          fill="#020617"
          opacity="0.75"
        />

        <!-- Inclusions internes (profondeur, sans taches blanches) -->
        <ellipse
          cx="52"
          cy="58"
          rx="11"
          ry="18"
          fill="url(#facetRoundWarm)"
          opacity="0.6"
        />
        <ellipse
          cx="70"
          cy="63"
          rx="9"
          ry="15"
          fill="url(#facetRoundWarm)"
          opacity="0.45"
        />
      </svg>
    </button>
  </section>

  <!-- PANELS : générateurs + upgrades -->
  <section class="panels">
    <div class="panel">
      <h2>Générateurs</h2>
      <ul class="list">
        @for (g of generators(); track g.id) {
          <li>
            <div class="item-main">
              <div class="icon" aria-hidden="true">⚙️</div>
              <div class="meta">
                <div class="name">{{ g.name }}</div>
                <div class="desc">+{{ fmt(g.cps) }} / sec</div>
              </div>
            </div>

            <div class="item-actions">
              <div class="price">{{ fmt(g.nextCost) }}</div>
              <button
                (click)="buyGenerator(g.id)"
                [disabled]="money() < g.nextCost"
              >
                Acheter
              </button>
              <div class="qty">x{{ g.quantity }}</div>
            </div>
          </li>
        }
      </ul>
    </div>

    <div class="panel">
      <h2>Améliorations</h2>
      <ul class="list">
        @for (u of upgrades(); track u.id) {
          <li>
            <div class="item-main">
              <div class="icon" aria-hidden="true">✨</div>
              <div class="meta">
                <div class="name">{{ u.name }}</div>
                <div class="desc">{{ u.description }}</div>
              </div>
            </div>

            <div class="item-actions">
              <div class="price">{{ fmt(u.nextCost) }}</div>
              <button
                (click)="buyUpgrade(u.id)"
                [disabled]="
                  money() < u.nextCost ||
                  (u.id === 'auto-clicker' && u.quantity >= 1)
                "
              >
                Acheter
              </button>
              <div class="qty">x{{ u.quantity }}</div>
            </div>
          </li>
        }
      </ul>
    </div>
  </section>

  <footer class="footer">
    <p>Projet démo — sauvegarde locale automatique. Aucune donnée personnelle.</p>
  </footer>
</main>
